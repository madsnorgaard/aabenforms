uuid: f1a2b3c4-d5e6-7890-1234-567890abcdef
langcode: en
status: true
dependencies:
  module:
    - aabenforms_workflows
    - eca_content
id: parent1_approval_flow
weight: null
template: null
events:
  parent1_starts_approval:
    plugin: 'content_entity:update'
    configuration:
      type: webform_submission
    successors:
      - id: check_parent1_pending
        condition: ''
conditions:
  check_parent1_pending:
    plugin: eca_scalar
    configuration:
      left_value: '[webform_submission:data:parent1_status]'
      operator: '=='
      right_value: 'pending'
    successors:
      - id: parent1_mitid
        condition: 'true'
gateways: {  }
actions:
  parent1_mitid:
    label: 'Parent 1: Validate MitID'
    plugin: aabenforms_mitid_validate
    configuration:
      workflow_id_token: workflow_id_parent1
      result_token: parent1_mitid_valid
      session_data_token: parent1_session
    successors:
      - id: parent1_cpr
        condition: ''

  parent1_cpr:
    label: 'Parent 1: CPR Lookup'
    plugin: aabenforms_cpr_lookup
    configuration:
      cpr_token: '[parent1_session:cpr]'
      result_token: parent1_data
      use_cache: true
    successors:
      - id: parent1_audit
        condition: ''

  parent1_audit:
    label: 'Parent 1: Audit Log'
    plugin: aabenforms_audit_log
    configuration:
      event_type_token: parent1_approval
      user_data_token: '[parent1_data:name]'
      metadata_token: 'Parent 1 authenticated and approved'
    successors:
      - id: mark_parent1_complete
        condition: ''

  mark_parent1_complete:
    label: 'Mark Parent 1 Complete'
    plugin: eca_token_set_value
    configuration:
      token_name: parent1_status
      token_value: 'complete'
    successors: {  }
