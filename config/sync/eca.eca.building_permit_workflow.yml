uuid: 0e798b58-7795-4077-98a2-ff92631f0162
langcode: en
status: true
dependencies:
  module:
    - aabenforms_workflows
    - aabenforms_mitid
    - webform
id: building_permit_workflow
label: 'Building Permit Application Workflow'
version: '1.0'
events:
  webform_submission_insert:
    plugin: 'content_entity:insert'
    configuration:
      type: webform_submission
      bundle: building_permit
    successors:
      - validate_applicant_mitid
modeller: fallback
conditions: {  }
actions:
  validate_applicant_mitid:
    plugin: aabenforms_mitid_validate
    configuration:
      workflow_id_token: permit_workflow_id
      result_token: mitid_valid
      session_data_token: applicant_session
    successors:
      - lookup_applicant_cpr
  lookup_applicant_cpr:
    plugin: aabenforms_cpr_lookup
    configuration:
      cpr_token: '[applicant_session:cpr]'
      result_token: applicant_person_data
      use_cache: true
    successors:
      - lookup_company_cvr
  lookup_company_cvr:
    plugin: aabenforms_cvr_lookup
    configuration:
      cvr_token: '[webform_submission:values:company_cvr]'
      result_token: company_data
      use_cache: true
    successors:
      - audit_permit_application
  audit_permit_application:
    plugin: aabenforms_audit_log
    configuration:
      event_type_token: building_permit_submitted
      user_data_token: '[applicant_person_data:name]'
      metadata_token: 'CPR:[applicant_session:cpr] CVR:[company_data:cvr] Address:[webform_submission:values:property_address]'
    successors: [  ]
