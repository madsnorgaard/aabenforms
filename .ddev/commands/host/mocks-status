#!/bin/bash

## Description: Check status of Danish government mock services
## Usage: ddev mocks-status
## Example: ddev mocks-status

echo "=== Danish Government Mock Services Status ==="
echo ""

# Check Keycloak (MitID Mock)
echo "üîë Keycloak (MitID + UNI-Login):"
if curl -s http://localhost:8080/health/ready > /dev/null 2>&1; then
  echo "   ‚úÖ Running on http://localhost:8080"
  echo "   üìä Admin UI: http://localhost:8080/admin (admin/admin)"
  echo "   üîó Realm: danish-gov-test"
else
  echo "   ‚ùå Not running"
fi
echo ""

# Check WireMock (Serviceplatformen Mock)
echo "üåê WireMock (Serviceplatformen):"
if curl -s http://localhost:8081/__admin/health > /dev/null 2>&1; then
  echo "   ‚úÖ Running on http://localhost:8081"
  echo "   üìä Admin UI: http://localhost:8081/__admin"

  # Count mappings
  MAPPINGS=$(curl -s http://localhost:8081/__admin/mappings | grep -o '"id"' | wc -l)
  echo "   üìù Loaded mappings: $MAPPINGS"
else
  echo "   ‚ùå Not running"
fi
echo ""

# Check Prism (DAWA Mock)
echo "üè† Prism (DAWA Address API):"
if curl -s http://localhost:8082 > /dev/null 2>&1; then
  echo "   ‚úÖ Running on http://localhost:8082"
  echo "   üìä OpenAPI Docs: http://localhost:8082"
else
  echo "   ‚ùå Not running"
fi
echo ""

echo "=== Quick Start ==="
echo "‚Ä¢ Login to Keycloak: http://localhost:8080/admin (admin/admin)"
echo "‚Ä¢ View test users: Realm 'danish-gov-test' ‚Üí Users"
echo "‚Ä¢ Test MitID login: http://localhost:8080/realms/danish-gov-test/account"
echo "‚Ä¢ Test CPR lookup: curl -X POST http://localhost:8081/sf1520 --data @test-cpr-request.xml"
echo "‚Ä¢ Test address search: curl http://localhost:8082/adresser/autocomplete?q=frederiksberg"
echo ""
